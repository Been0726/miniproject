<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<div th:fragment="header">

  <!-- âœ… header ë†’ì´ì™€ ì •ë ¬ ê°•ì œ í†µì¼ -->
  <style>
    .navbar {
      height: 64px !important;
      min-height: 64px !important;
      padding-top: 0 !important;
      padding-bottom: 0 !important;
      font-size: 1rem !important;
    }

    .navbar .container-fluid {
      height: 64px !important;
      align-items: center !important;
    }

    .navbar .collapse {
      height: auto !important;
    }

    .navbar-brand {
      font-size: 1.25rem !important;
      font-weight: bold !important;
      line-height: 1 !important;
      color: white !important;
    }

    .navbar .btn,
    .navbar .form-control,
    .navbar .nav-link {
      font-size: 1rem !important;
      padding-top: 0.375rem;
      padding-bottom: 0.375rem;
      line-height: 1.5;
    }

    .navbar .form-control-sm {
      font-size: 0.9rem !important;
    }

    .navbar-toggler {
      height: 40px;
    }
  </style>

  <nav class="navbar navbar-expand-sm navbar-dark px-4" style="background-color: #343a40;">
    <div class="container-fluid">
      <a class="navbar-brand" href="/">JB Art Soccer</a>

      <button class="navbar-toggler" type="button"
              data-bs-toggle="collapse"
              data-bs-target="#navbarTogglerDemo03"
              aria-controls="navbarTogglerDemo03"
              aria-expanded="false"
              aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse justify-content-between" id="navbarTogglerDemo03">
        <!-- ì™¼ìª½ ë©”ë‰´ -->
        <ul class="navbar-nav mb-2 mb-lg-0">
          <li class="nav-item" sec:authorize="hasAnyAuthority('ROLE_ADMIN')">
            <a class="nav-link" href="/admin/item/new">ìƒí’ˆ ë“±ë¡</a>
          </li>
          <li class="nav-item" sec:authorize="hasAnyAuthority('ROLE_ADMIN')">
            <a class="nav-link" href="/admin/items">ìƒí’ˆ ê´€ë¦¬</a>
          </li>
          <li class="nav-item" sec:authorize="hasAnyAuthority('ROLE_ADMIN')">
            <a class="nav-link" href="/admin/match-status">ë§¤ì¹­ í†µê³„</a>
          </li>
        </ul>

        <!-- ì˜¤ë¥¸ìª½ ë©”ë‰´ -->
        <div class="d-flex align-items-center gap-3">
          <!-- ë¡œê·¸ì¸ ìƒíƒœ -->
          <div sec:authorize="isAuthenticated()" class="d-flex align-items-center text-white gap-3">
            <!-- ì•Œë¦¼ -->
            <div class="position-relative">
              <button type="button" class="btn btn-sm btn-outline-light position-relative"
                      data-bs-toggle="modal" data-bs-target="#notificationModal">
                ğŸ””
                <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger"
                      th:if="${notificationCount > 0}" th:text="${notificationCount}">0</span>
              </button>
            </div>

            <!-- ë©”ë‰´ -->
            <div class="dropdown">
              <a href="#" class="btn btn-sm btn-outline-light icon-btn" id="serviceDropdown"
                 data-bs-toggle="dropdown" aria-expanded="false">âš½ï¸</a>

              <div class="dropdown-menu dropdown-menu-end p-3 shadow"
                   aria-labelledby="serviceDropdown"
                   data-bs-auto-close="outside"
                   style="min-width: 280px; max-width: 320px;">
                <div class="text-center mb-2">
                  <strong th:if="${loginNickname != null}" th:text="${'âš½ï¸ ' + loginNickname + 'ë‹˜'}">ë‹‰ë„¤ì„</strong>
                  <div class="text-muted small mt-1">
                    <span th:text="'ë³´ìœ  í¬ì¸íŠ¸: ' + ${loginPoint} + ' P'">ë³´ìœ  í¬ì¸íŠ¸: 0 P</span>
                  </div>
                </div>


                <div class="row g-2 text-center">
                  <div class="col-4"><a href="/myPage" class="text-decoration-none text-dark d-block">ğŸ™‹â€â™‚ï¸<div class="small mt-1">ë§ˆì´í˜ì´ì§€</div></a></div>
                  <div class="col-4"><a href="/point/charge" class="text-decoration-none text-dark d-block">ğŸ’°<div class="small mt-1">í¬ì¸íŠ¸ ì¶©ì „</div></a></div>
                  <div class="col-4"><a href="/point/history" class="text-decoration-none text-dark d-block">ğŸ“œ<div class="small mt-1">í¬ì¸íŠ¸ ë‚´ì—­</div></a></div>
                  <div class="col-4"><a href="/myRatings" class="text-decoration-none text-dark d-block">â­<div class="small mt-1">ë‚´ í‰ì </div></a></div>
                  <div class="col-4"><a href="/cart" class="text-decoration-none text-dark d-block">ğŸ›’<div class="small mt-1">ì¥ë°”êµ¬ë‹ˆ</div></a></div>
                  <div class="col-4"><a href="/orders" class="text-decoration-none text-dark d-block">ğŸ“¦<div class="small mt-1">êµ¬ë§¤ì´ë ¥</div></a></div>
                </div>
                <hr>
                <div class="text-center"><small class="text-muted">ì„œë¹„ìŠ¤ ë°”ë¡œê°€ê¸° ë©”ë‰´ì…ë‹ˆë‹¤</small></div>
              </div>
            </div>

            <!-- ë¡œê·¸ì•„ì›ƒ -->
            <a class="btn btn-sm btn-outline-light" href="/members/logout">ë¡œê·¸ì•„ì›ƒ</a>
          </div>

          <!-- ë¹„ë¡œê·¸ì¸ ìƒíƒœ -->
          <ul class="navbar-nav" sec:authorize="isAnonymous()">
            <li class="nav-item"><a class="btn btn-sm btn-outline-light" href="/members/new">íšŒì›ê°€ì…</a></li>
            <li class="nav-item"><a class="btn btn-sm btn-outline-light" href="/members/login">ë¡œê·¸ì¸</a></li>
          </ul>

          <!-- ê²€ìƒ‰ì°½ -->
          <form class="d-flex align-items-center" th:action="@{/}" method="get">
            <input name="searchQuery" class="form-control form-control-sm me-2" type="search" placeholder="Search" aria-label="Search">
            <button class="btn btn-sm btn-outline-success" type="submit">Search</button>
          </form>
        </div>
      </div>
    </div>
  </nav>

  <!-- ì•Œë¦¼ ëª¨ë‹¬ -->
  <div class="modal fade" id="notificationModal" tabindex="-1" aria-labelledby="notificationModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="notificationModalLabel">ìµœê·¼ ì•Œë¦¼</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <ul class="list-group" th:inline="javascript">
            <li th:each="n : ${notifications}"
                th:id="'notification-' + ${n.id}"
                th:onclick="'markAsRead(' + ${n.id} + ')'"
                th:classappend="${n.read} ? '' : 'bg-light fw-bold'"
                class="list-group-item d-flex justify-content-between align-items-start position-relative"
                style="cursor: pointer;">
              <div class="ms-2 me-auto">
                <div th:text="${n.content}">ì•Œë¦¼ ë‚´ìš©</div>
                <small class="text-muted" th:text="${#temporals.format(n.regTime, 'yyyy-MM-dd HH:mm')}">ë‚ ì§œ</small>
              </div>
              <button type="button"
                      class="btn-close position-absolute top-0 end-0 mt-2 me-2"
                      th:onclick="'event.stopPropagation(); deleteNotification(' + ${n.id} + ')'"></button>
            </li>
          </ul>
          <div th:if="${notifications == null or notifications.isEmpty()}">
            <p class="text-center text-muted">ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Flash ë©”ì‹œì§€ -->
  <div th:if="${msg}" th:text="${msg}" class="alert alert-primary alert-dismissible fade show mt-2" role="alert">
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>

</div>
</html>
